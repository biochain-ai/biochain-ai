<html>
<head></head>
	<script>
		// Retrieve cookie
		function getCookie(user) {
			var cookieArr = document.cookie.split(";");
			for(var i = 0; i < cookieArr.length; i++) {
				var cookiePair = cookieArr[i].split("=");
				if(user == cookiePair[0].trim()) {
					return decodeURIComponent(cookiePair[1]);
				}
			}
			return null;
		}
		
		// Check cookie existence and display its content
		function checkCookie () {
			var user = getCookie("BiochainCookie")
			if (user != null){
				document.getElementById("cookie-par").textContent = "Benvenuto " + user
			}
			else{
				document.getElementById("cookie-par").textContent = "Benvenuto!"
			}
		}

		// On load, call function
		window.onload = function (){
			checkCookie();
		}

	</script>
<body>
<h1>Welcome to BIOCHAIN-AI</h1>
	<input type="button" onclick="location.href='http://localhost:8080/login';" value="Login con Google" />
	<button onclick="logout()">Logout</button>
	<p id="cookie-par"></p>
	<br>
	<button onclick="bootstrapParma()">Entra come Parma</button>
	<button onclick="bootstrapBrescia()">Entra come Brescia</button>
	<br>
	<br>
	
	<hr>
	<h4>Inserisci un nuovo dato</h4>
	<form name="insertDataForm" id="insertDataForm" onSubmit="JavaScript:insertData()">
		<label for="firstname">Nome Dato</label>
		<input type="text" name="name" id="name" /><br />
		<label for="lastname">Descrizione</label>
		<input type="text" name="description" id="description"/><br />
		<label for="lastname">Dato</label>
		<input type="text" name="data" id="data"/><br />
		<input name="" type="submit" value="Inserisci il dato" />
	</form>
	
	<hr>
	<h4>Inserisci un nuovo utente</h4>
	<form name="addUserForm" id="addUserForm" onSubmit="JavaScript:addUser()">
		<label for="mail">Mail</label>
		<input type="text" name="mail" id="mail" /><br />
		<label for="commonname">Nome</label>
		<input type="text" name="commonname" id="commonname" /><br />
		<label for="org">Organizzazione</label>
		<input type="text" name="org" id="org"/><br />
		<input name="" type="submit" value="Inserisci l'utente" />
	</form>
	
	<hr>

	<br>
	<button onclick="viewCatalogue()">Vedi il catalogo</button>
	<br>
	<button onclick="viewAllUsers()">Visualizza tutti gli utenti</button>
	<br>
	
	
	<div>
		<p>Risultato:</p>
		<p id="res" style="background-color:rgb(88, 158, 214);"></p>
	</div>

	
	<script>
		function logout() {
			var mail = getCookie("BiochainCookie")
			if (mail != null) {
				document.cookie = "BiochainCookie" + '=; Max-Age=-1;';  
			}
			checkCookie()
		}
			function insertData() {
				event.preventDefault();
				var xhr = new XMLHttpRequest();

				// Definisci il tipo di richiesta e l'URL di destinazione
				xhr.open("POST", "http://localhost:3000/insertData", true);
				xhr.setRequestHeader("Accept", "application/json");
				xhr.setRequestHeader("Content-Type", "application/json");

				// Imposta la funzione di callback per gestire la risposta
				xhr.onload = function() {
					if (xhr.status === 200) {
					// La richiesta è stata completata con successo
					var response = xhr.responseText;
					// Puoi manipolare la risposta qui come desideri
					//console.log(response);
					// Scrive la risposta in un paragrafo	
					document.getElementById("res").textContent = response
					// Si è verificato un errore durante la richiesta
					console.error("Errore nella richiesta. Codice: " + xhr.status);
					}
				};

				// Leggi i dati dal form
				var name = document.getElementById("name").value;
				var description = document.getElementById("description").value;
				var data = document.getElementById("data").value;
			
				// Crea l'oggetto dei dati da inviare come JSON
				var obj = {
					name: name,
					description: description,
					data: data
				};

				// Invia la richiesta
				xhr.send(JSON.stringify(obj));
				var insertForm = document.getElementById("insertDataForm");
				insertForm.reset();
			}

			function addUser() {
				event.preventDefault();

				var mail = getCookie("BiochainCookie")
				if (mail == null) {
					document.getElementById("res").textContent = "Devi effettuare il login prima di inserire un utente!";
					return;
				}
				
				var xhr = new XMLHttpRequest();

				// Definisci il tipo di richiesta e l'URL di destinazione
				xhr.open("POST", "http://localhost:3000/addUser", true);
				xhr.setRequestHeader("Accept", "application/json");
				xhr.setRequestHeader("Content-Type", "application/json");

				// Imposta la funzione di callback per gestire la risposta
				xhr.onload = function() {
					if (xhr.status === 200) {
					// La richiesta è stata completata con successo
					var response = xhr.responseText;
					// Puoi manipolare la risposta qui come desideri
					//console.log(response);
					// Scrive la risposta in un paragrafo	
					document.getElementById("res").textContent = response
					// Si è verificato un errore durante la richiesta
					console.error("Errore nella richiesta. Codice: " + xhr.status);
					}
				};

				// Leggi i dati dal form
				var mail = document.getElementById("mail").value;
				var commonname = document.getElementById("commonname").value;
				var org = document.getElementById("org").value;
				var level = 0;
			
				// Crea l'oggetto dei dati da inviare come JSON
				var obj = {
					mail: mail,
					org: org,
					commonname: commonname,
					level: level
				};

				// Invia la richiesta
				xhr.send(JSON.stringify(obj));
				var insertForm = document.getElementById("addUserForm");
				insertForm.reset();
			}

			function viewCatalogue() {
				// Crea l'oggetto XMLHttpRequest
				var xhr = new XMLHttpRequest();

				// Definisci il tipo di richiesta e l'URL di destinazione
				xhr.open("GET", "http://localhost:3000/view?function=catalogue", true);

				// Imposta la funzione di callback per gestire la risposta
				xhr.onload = function() {
					if (xhr.status === 200) {
					// La richiesta è stata completata con successo
					var response = xhr.responseText;
					// Puoi manipolare la risposta qui come desideri
					console.log(response);
					document.getElementById("res").textContent = response
					} else {
					// Si è verificato un errore durante la richiesta
					console.error("Errore nella richiesta. Codice: " + xhr.status);
					}
				};

				// Invia la richiesta
				xhr.send();
			}
			function viewAllUsers(){
				// Crea l'oggetto XMLHttpRequest
				var xhr = new XMLHttpRequest();

				// Definisci il tipo di richiesta e l'URL di destinazione
				xhr.open("GET", "http://localhost:3000/viewAllUsers", true);

				// Imposta la funzione di callback per gestire la risposta
				xhr.onload = function() {
					if (xhr.status === 200) {
					// La richiesta è stata completata con successo
					var response = xhr.responseText;
					// Puoi manipolare la risposta qui come desideri
					console.log(response);
					document.getElementById("res").textContent = response
					} else {
					// Si è verificato un errore durante la richiesta
					console.error("Errore nella richiesta. Codice: " + xhr.status);
					}
				};

				// Invia la richiesta
				xhr.send();
			}

			function bootstrapParma() {
				// Crea l'oggetto XMLHttpRequest
				var xhr = new XMLHttpRequest();

				// Definisci il tipo di richiesta e l'URL di destinazione
				xhr.open("GET", "http://localhost:3000/bootstrap?org=parma&msp=ParmaMSP&port=7051", true);

				// Imposta la funzione di callback per gestire la risposta
				xhr.onload = function() {
				if (xhr.status === 200) {
				// La richiesta è stata completata con successo
				var response = xhr.responseText;
				// Puoi manipolare la risposta qui come desideri
				console.log(response);
				document.getElementById("res").textContent = response
				} else {
				// Si è verificato un errore durante la richiesta
				console.error("Errore nella richiesta. Codice: " + xhr.status);
				}
				};

				// Invia la richiesta
				xhr.send();
			}
			function bootstrapBrescia() {
				// Crea l'oggetto XMLHttpRequest
				var xhr = new XMLHttpRequest();

				// Definisci il tipo di richiesta e l'URL di destinazione
				xhr.open("GET", "http://localhost:3000/bootstrap?org=brescia&msp=BresciaMSP&port=7051", true);

				// Imposta la funzione di callback per gestire la risposta
				xhr.onload = function() {
				if (xhr.status === 200) {
				// La richiesta è stata completata con successo
				var response = xhr.responseText;
				// Puoi manipolare la risposta qui come desideri
				console.log(response);
				} else {
				// Si è verificato un errore durante la richiesta
				console.error("Errore nella richiesta. Codice: " + xhr.status);
				}
				};

				// Invia la richiesta
				xhr.send();
			}
	</script>
</body>
</html>